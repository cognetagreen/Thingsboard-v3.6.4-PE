{
  "entityType" : "WIDGET_TYPE",
  "entity" : {
    "fqn" : "barchart22",
    "name" : "BarChart2",
    "deprecated" : false,
    "image" : null,
    "description" : null,
    "descriptor" : {
      "type" : "timeseries",
      "sizeX" : 10.5,
      "sizeY" : 6.5,
      "resources" : [ {
        "url" : "https://code.highcharts.com/highcharts.js"
      }, {
        "url" : "https://code.highcharts.com/modules/exporting.js"
      }, {
        "url" : "https://code.highcharts.com/modules/export-data.js"
      } ],
      "templateHtml" : "\r\n<div id=\"br2\" class=\"des\" style=\"width: 100%;\"></div>\r\n\r\n\r\n",
      "templateCss" : ".des {\n    padding-top: 8px;\n    height: 100%;\n}\n\n.legend {\n    font-size: 13px;\n    line-height: 10px;\n}\n\n.legend table { \n    border-spacing: 0px;\n    border-collapse: separate;\n}\n\n.mouse-events .flot-overlay {\n    cursor: crosshair; \n}\n\n",
      "controllerScript" : "// var myChart;\r\n\r\n// self.onInit = function() {\r\n    \r\n//     var chartData = {\r\n//         series: []\r\n//     };\r\n\r\n//     for (var i=0; i < self.ctx.data.length; i++) {\r\n//         var dataKey = self.ctx.data[i].dataKey;\r\n//         var series = {\r\n//             name: dataKey.label,\r\n//             data: [],\r\n//             color: dataKey.color\r\n//         };\r\n//         chartData.series.push(series);\r\n//     }\r\n    \r\n//     var options = {\r\n//         chart: {\r\n//             type: 'column',\r\n//             height: '45%', // Set initial height to 50%\r\n//             events: {\r\n//                 load: function () {\r\n//                     this.reflow(); // Trigger reflow on chart load\r\n//                 },\r\n//             },\r\n//             renderTo: 'br2',\r\n//         },\r\n//         title: false,\r\n//         tooltip: {\r\n//             shared: true,\r\n//             formatter: function () {\r\n//                 var date = Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x); // Format date in UTC\r\n//                 var istDate = moment.utc(date).tz('Asia/Kolkata').format('YYYY-MM-DD HH:mm:ss'); // Convert UTC to IST\r\n//                 var points = this.points.map(function (point) {\r\n//                     return '<span style=\"color:' + point.color + '\">\\u25CF</span> ' + point.series.name + ': <b>' + point.y + '</b>';\r\n//                 });\r\n//                 return '<b>' + istDate + '</b><br/>' + points.join('<br/>');\r\n//             }\r\n//         },\r\n//         xAxis: {\r\n//             type: 'datetime',\r\n//             tickPixelInterval: 150,\r\n//             timezone: 'Asia/Kolkata' // Set timezone to IST for x-axis\r\n//         },\r\n//         yAxis: {\r\n//             title: {\r\n//                 text: 'kWh'\r\n//             }\r\n//         },\r\n//         legend: {\r\n//             enabled: true,\r\n//             itemStyle: {\r\n//                 fontSize: \"10px\"\r\n//             }\r\n//         },\r\n//         plotOptions: {\r\n//             column: {\r\n//             //   pointWidth: 300\r\n//             },\r\n//             series: {\r\n//                 // Remove marker and shadow options\r\n//             }\r\n//         },\r\n//         exporting: {\r\n//             buttons: {\r\n//                 contextButton: {\r\n//                     menuItems: ['downloadCSV', 'downloadPNG'] // Specify CSV and PNG download options\r\n//                 }\r\n//             }\r\n//         },\r\n//         credits: {\r\n//             enabled: false // Remove Highcharts logo\r\n//         }\r\n//     };\r\n    \r\n//     myChart = new Highcharts.Chart(options);\r\n//     self.onResize();\r\n// };\r\n\r\n// self.onResize = function() {\r\n//     if (myChart) {\r\n//         var chartContainer = document.getElementById('br2'); \r\n//         var containerWidth = chartContainer.offsetWidth;\r\n//         var containerHeight = chartContainer.offsetHeight;\r\n//         myChart.setSize(containerWidth, '45%', false);\r\n//     }\r\n// };\r\n\r\n// self.onDataUpdated = function() {\r\n//     for (var i = 0; i < self.ctx.data.length; i++) {\r\n//         var datasourceData = self.ctx.data[i];\r\n//         var dataSet = datasourceData.data;\r\n//         var series = myChart.series[i];\r\n//         if (!series) {\r\n//             series = myChart.addSeries({\r\n//                 name: datasourceData.dataKey.label,\r\n//                 data: [],\r\n//                 color: self.ctx.data[i].dataKey.color\r\n//             }, false);\r\n//         }\r\n//         var data = dataSet.map(function(tsValuePair) {\r\n//             return { x: tsValuePair[0], y: tsValuePair[1] };\r\n//         });\r\n//         var tsArr = self.ctx.data[i].data.map(elem => {\r\n//             var date = new Date(elem[0]);\r\n//             var dateString = date.toLocaleString().split(\",\")[0].replace(/\\//g, \"\");\r\n//             return [dateString, elem[0], elem[1]];\r\n//         });\r\n//         console.log(tsArr)\r\n//         var lastValuesMap = new Map();\r\n\r\n//         // Iterate over tsArr\r\n//         tsArr.forEach(subarr => {\r\n//             var dateString = subarr[0];\r\n//             var ts = subarr[1]\r\n//             var value = subarr[2];\r\n            \r\n//             // Update the value for the current date string\r\n//             // Check if value is not zero\r\n//             if (value !== 0) {\r\n//                 // Update the value for the current date string\r\n//                 lastValuesMap.set(dateString, [ts, value]); // Storing [ts, value] as the value\r\n//             }\r\n//         });\r\n\r\n//         // Extract the last values for each date string\r\n//         data = Array.from(lastValuesMap.values());\r\n//         console.log(data);\r\n//         series.setData(data, true);\r\n//     }\r\n// }\r\n\r\n\r\n\r\n\r\n\r\n\r\nself.onInit = function() {\r\n    // console.log(self.ctx.data)\r\n    console.log(777777,self.ctx.currentUser.customerId, self.ctx.currentUser.tenantId, self.ctx.currentUser.firstName, self.ctx.currentUser.userId);\r\n    var chartData = {\r\n        series: []\r\n    };\r\n\r\n    for (var i=0; i < self.ctx.data.length; i++) {\r\n        var dataKey = self.ctx.data[i].dataKey;\r\n        var series = {\r\n            name: dataKey.label,\r\n            data: [],\r\n            color: dataKey.color\r\n        };\r\n        chartData.series.push(series);\r\n    }\r\n    \r\n    var options = {\r\n        chart: {\r\n            type: 'column',\r\n            height: '55%', // Set initial height to 50%\r\n            events: {\r\n                load: function () {\r\n                    this.reflow(); // Trigger reflow on chart load\r\n                },\r\n            },\r\n            renderTo: 'br2',\r\n        },\r\n        title: false,\r\n        tooltip: {\r\n            shared: true,\r\n            formatter: function () {\r\n                var date = Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x); // Format date in UTC\r\n                var istDate = moment.utc(date).tz('Asia/Kolkata').format('YYYY-MM-DD HH:mm:ss'); // Convert UTC to IST\r\n                var points = this.points.map(function (point) {\r\n                    return '<span style=\"color:' + point.color + '\">\\u25CF</span> ' + point.series.name + ': <b>' + point.y + '</b>';\r\n                });\r\n                return '<b>' + istDate + '</b><br/>' + points.join('<br/>');\r\n            }\r\n        },\r\n        xAxis: {\r\n            type: 'datetime',\r\n            tickPixelInterval: 150,\r\n            timezone: 'Asia/Kolkata' // Set timezone to IST for x-axis\r\n        },\r\n        yAxis: {\r\n            title: {\r\n                text: 'kWh'\r\n            },\r\n        },\r\n        legend: {\r\n            enabled: true,\r\n            itemStyle: {\r\n                fontSize: \"10px\"\r\n            }\r\n        },\r\n        plotOptions: {\r\n            column: {\r\n                pointPadding: 0.5, // Adjust this value to separate the bars more\r\n                groupPadding: 0.2, // Adjust this value to separate the groups more\r\n                pointWidth: 10,\r\n            },\r\n            series: {\r\n                // Remove marker and shadow options\r\n            }\r\n        },\r\n        exporting: {\r\n            buttons: {\r\n                contextButton: {\r\n                    menuItems: ['downloadCSV', 'downloadPNG'] // Specify CSV and PNG download options\r\n                }\r\n            }\r\n        },\r\n        credits: {\r\n            enabled: false // Remove Highcharts logo\r\n        }\r\n    };\r\n    \r\n    myChart = new Highcharts.Chart(options);\r\n    self.onResize();\r\n};\r\n\r\nself.onResize = function() {\r\n    if (myChart) {\r\n        var chartContainer = document.getElementById('br2'); \r\n        var containerWidth = chartContainer.offsetWidth;\r\n        var containerHeight = chartContainer.offsetHeight;\r\n        myChart.setSize(containerWidth, '45%', false);\r\n    }\r\n};\r\n\r\nself.onDataUpdated = function() {\r\n    for (var i = 0; i < self.ctx.data.length; i++) {\r\n        var datasourceData = self.ctx.data[i];\r\n        var dataSet = datasourceData.data;\r\n        var series = myChart.series[i];\r\n        if (!series) {\r\n            series = myChart.addSeries({\r\n                name: datasourceData.dataKey.label,\r\n                data: [],\r\n                color: self.ctx.data[i].dataKey.color\r\n            }, false);\r\n        }\r\n        var data = dataSet.map(function(tsValuePair) {\r\n            return { x: tsValuePair[0], y: tsValuePair[1] };\r\n        });\r\n        var tsArr = self.ctx.data[i].data.map(elem => {\r\n            var date = new Date(elem[0]);\r\n            var dateString = date.toLocaleString().split(\",\")[0].replace(/\\//g, \"\");\r\n            return [dateString, elem[0], parseFloat(elem[1])];\r\n        });\r\n        // console.log(tsArr)\r\n        var lastValuesMap = new Map();\r\n\r\n        // Iterate over tsArr\r\n        tsArr.forEach(subarr => {\r\n            var dateString = subarr[0];\r\n            var date = new Date(subarr[1]);\r\n            date.setSeconds(0,0);\r\n            date.setMinutes(0);\r\n            var ts = date.getTime();\r\n            var value = subarr[2];\r\n            \r\n            // Update the value for the current date string\r\n            // Check if value is not zero\r\n            // if (value !== 0) {\r\n                // Update the value for the current date string\r\n                lastValuesMap.set(dateString, [ts, value]); // Storing [ts, value] as the value\r\n            // }\r\n            // else {\r\n            //     if(!lastValuesMap) {\r\n            //         lastValuesMap.set(dateString, [ts, value]);\r\n            //     }\r\n            // }\r\n        });\r\n\r\n        // Extract the last values for each date string\r\n        data = Array.from(lastValuesMap.values());\r\n        // console.log(\"data\", data);\r\n        series.setData(data, true);\r\n    }\r\n}\r\n",
      "settingsSchema" : "{}",
      "dataKeySettingsSchema" : "{}",
      "latestDataKeySettingsSchema" : "{}",
      "settingsDirective" : "tb-flot-line-widget-settings",
      "dataKeySettingsDirective" : "tb-flot-line-key-settings",
      "latestDataKeySettingsDirective" : "tb-flot-latest-key-settings",
      "hasBasicMode" : true,
      "basicModeDirective" : "tb-flot-basic-config",
      "defaultConfig" : "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"First\",\"color\":\"#10DE35\",\"settings\":{\"showLines\":true,\"fillLines\":true,\"showPoints\":false},\"_hash\":0.8587686344902596,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\",\"aggregationType\":null,\"units\":null,\"decimals\":null,\"usePostProcessing\":null,\"postFuncBody\":null},{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Second\",\"color\":\"#ffc107\",\"settings\":{\"showLines\":true,\"fillLines\":false,\"showPoints\":false},\"_hash\":0.12775350966079668,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":false,\"backgroundColor\":\"#fff\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{\"stack\":false,\"fontSize\":10,\"fontColor\":\"#545454\",\"showTooltip\":true,\"tooltipIndividual\":false,\"tooltipCumulative\":false,\"hideZeros\":false,\"grid\":{\"verticalLines\":true,\"horizontalLines\":true,\"outlineWidth\":1,\"color\":\"#545454\",\"backgroundColor\":null,\"tickColor\":\"#DDDDDD\"},\"xaxis\":{\"title\":null,\"showLabels\":true,\"color\":\"#545454\"},\"yaxis\":{\"min\":null,\"max\":null,\"title\":null,\"showLabels\":true,\"color\":\"#545454\",\"tickSize\":null,\"tickDecimals\":0,\"ticksFormatter\":\"\"},\"shadowSize\":4,\"smoothLines\":false,\"comparisonEnabled\":false,\"xaxisSecond\":{\"axisPosition\":\"top\",\"title\":null,\"showLabels\":true},\"showLegend\":true,\"legendConfig\":{\"direction\":\"column\",\"position\":\"bottom\",\"sortDataKeys\":false,\"showMin\":false,\"showMax\":false,\"showAvg\":true,\"showTotal\":false,\"showLatest\":false},\"customLegendEnabled\":false},\"title\":\"BarChart1\",\"dropShadow\":true,\"enableFullscreen\":true,\"titleStyle\":{\"fontSize\":\"16px\",\"fontWeight\":400},\"mobileHeight\":null,\"configMode\":\"basic\",\"actions\":{},\"showTitleIcon\":false,\"titleIcon\":\"thermostat\",\"iconColor\":\"#1F6BDD\",\"useDashboardTimewindow\":false,\"displayTimewindow\":true,\"titleFont\":null,\"titleColor\":null,\"enableDataExport\":true}"
    },
    "externalId" : null,
    "id" : {
      "entityType" : "WIDGET_TYPE",
      "id" : "fe683c20-1d83-11ef-982c-0f5367becb87"
    },
    "tags" : null
  },
  "relations" : [ ],
  "attributes" : {
    "SERVER_SCOPE" : [ ]
  }
}